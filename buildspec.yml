version: 0.2

phases:
  install:
    runtime-versions:
      nodejs: 23.7.0
    commands:
      # Install dependencies
      - echo Installing dependencies...
      - npm install -g aws-cdk
      - npm install

  pre_build:
    commands:
      # Run linting and tests if applicable
      - echo Running pre-build checks...
      - npm run lint || true
      - npm test || true

  build:
    commands:
      # Compile TypeScript
      - echo Compiling TypeScript...
      - npm run build

      # CDK synth to validate the stack and generate CloudFormation template
      - echo Synthesizing CDK stack...
      - cdk synth

  post_build:
    commands:
      # Prepare for deployment (if this is a deployment pipeline)
      - echo Build completed on `date`

artifacts:
  files:
    # Include CloudFormation templates generated by CDK
    - cdk.out/**/*
    # Include source code if needed for reference
    - lib/**/*
    - bin/**/*
    - package.json
    - package-lock.json
    - tsconfig.json
    - cdk.json
  discard-paths: no

cache:
  paths:
    - "node_modules/**/*"
